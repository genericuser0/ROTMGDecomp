package com.hurlant.util.der
{
   import com.hurlant.crypto.rsa.RSAKey;
   import com.hurlant.util.Base64;
   import flash.utils.ByteArray;
   
   public class PEM
   {
      
      private static const RSA_PRIVATE_KEY_HEADER:String = "-----BEGIN RSA PRIVATE KEY-----";
      
      private static const RSA_PRIVATE_KEY_FOOTER:String = "-----END RSA PRIVATE KEY-----";
      
      private static const RSA_PUBLIC_KEY_HEADER:String = "-----BEGIN PUBLIC KEY-----";
      
      private static const RSA_PUBLIC_KEY_FOOTER:String = "-----END PUBLIC KEY-----";
      
      private static const CERTIFICATE_HEADER:String = "-----BEGIN CERTIFICATE-----";
      
      private static const CERTIFICATE_FOOTER:String = "-----END CERTIFICATE-----";
      
      {
         method
         name null
         returns null
         
         body
         maxstack 2
         localcount 1
         initscopedepth 3
         maxscopedepth 4
         
         code
         getlocal_0
         pushscope
         findproperty Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_HEADER")
         pushstring "-----BEGIN RSA PRIVATE KEY-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_HEADER")
         findproperty Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_FOOTER")
         pushstring "-----END RSA PRIVATE KEY-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_FOOTER")
         findproperty Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_HEADER")
         pushstring "-----BEGIN PUBLIC KEY-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_HEADER")
         findproperty Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_FOOTER")
         pushstring "-----END PUBLIC KEY-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_FOOTER")
         findproperty Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_HEADER")
         pushstring "-----BEGIN CERTIFICATE-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_HEADER")
         findproperty Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_FOOTER")
         pushstring "-----END CERTIFICATE-----"
         initproperty Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_FOOTER")
         returnvoid
         end ; code
         end ; body
         end ; method
      }
      
      public function PEM()
      {
         method
         name null
         returns null
         
         body
         maxstack 1
         localcount 1
         initscopedepth 4
         maxscopedepth 5
         
         code
         getlocal_0
         pushscope
         getlocal_0
         constructsuper 0
         returnvoid
         end ; code
         end ; body
         end ; method
      }
      
      public static function readRSAPrivateKey(param1:String) : RSAKey
      {
         trait method Qname(PackageNamespace(""),"readRSAPrivateKey")
         flag FINAL
         dispid 3
         method
         name null
         param Qname(PackageNamespace(""),"String")
         returns Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey")
         
         body
         maxstack 10
         localcount 5
         initscopedepth 3
         maxscopedepth 4
         
         code
         getlocal_0
         pushscope
         pushnull
         coerce Qname(PackageNamespace(""),"Array")
         setlocal 4
         findpropstrict Qname(PrivateNamespace(null,"1282"),"extractBinary")
         getlex Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_HEADER")
         getlex Qname(PrivateNamespace(null,"1282"),"RSA_PRIVATE_KEY_FOOTER")
         getlocal_1
         callproperty Qname(PrivateNamespace(null,"1282"),"extractBinary") 3
         coerce Qname(PackageNamespace("flash.utils"),"ByteArray")
         setlocal_2
         getlocal_2
         pushnull
         ifne ofs0025
         pushnull
         returnvalue
         ofs0025:getlex Qname(PackageNamespace("com.hurlant.util.der"),"DER")
         getlocal_2
         callproperty Qname(PackageNamespace(""),"parse") 1
         coerce_a
         setlocal_3
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         istypelate
         iffalse ofs008c
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         astypelate
         coerce Qname(PackageNamespace(""),"Array")
         setlocal 4
         findpropstrict Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey")
         getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 2
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         callproperty Multiname("valueOf",[PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")]) 0
         getlocal 4
         pushbyte 3
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 4
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 5
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 6
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 7
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 8
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         constructprop Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey") 8
         returnvalue
         ofs008c:pushnull
         returnvalue
         end ; code
         end ; body
         end ; method
      }
      
      public static function readRSAPublicKey(param1:String) : RSAKey
      {
         trait method Qname(PackageNamespace(""),"readRSAPublicKey")
         flag FINAL
         dispid 4
         method
         name null
         param Qname(PackageNamespace(""),"String")
         returns Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey")
         
         body
         maxstack 4
         localcount 7
         initscopedepth 3
         maxscopedepth 4
         
         code
         getlocal_0
         pushscope
         pushnull
         coerce Qname(PackageNamespace(""),"Array")
         setlocal 4
         findpropstrict Qname(PrivateNamespace(null,"1282"),"extractBinary")
         getlex Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_HEADER")
         getlex Qname(PrivateNamespace(null,"1282"),"RSA_PUBLIC_KEY_FOOTER")
         getlocal_1
         callproperty Qname(PrivateNamespace(null,"1282"),"extractBinary") 3
         coerce Qname(PackageNamespace("flash.utils"),"ByteArray")
         setlocal_2
         getlocal_2
         pushnull
         ifne ofs0025
         pushnull
         returnvalue
         ofs0025:getlex Qname(PackageNamespace("com.hurlant.util.der"),"DER")
         getlocal_2
         callproperty Qname(PackageNamespace(""),"parse") 1
         coerce_a
         setlocal_3
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         istypelate
         iffalse ofs00d9
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         astypelate
         coerce Qname(PackageNamespace(""),"Array")
         dup
         setlocal 4
         pushbyte 0
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         pushbyte 0
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         callproperty Multiname("toString",[PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")]) 0
         getlex Qname(PackageNamespace("com.hurlant.util.der"),"OID")
         getproperty Qname(PackageNamespace(""),"RSA_ENCRYPTION")
         ifeq ofs005e
         pushnull
         returnvalue
         ofs005e:getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getproperty Multiname("position",[PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         pushbyte 0
         ifne ofs009a
         getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         dup
         setlocal 5
         getproperty Multiname("position",[PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         increment
         setlocal 6
         getlocal 5
         getlocal 6
         setproperty Multiname("position",[PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         kill 6
         kill 5
         ofs009a:getlex Qname(PackageNamespace("com.hurlant.util.der"),"DER")
         getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         callproperty Qname(PackageNamespace(""),"parse") 1
         coerce_a
         setlocal_3
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         istypelate
         iffalse ofs00d3
         getlocal_3
         getlex Qname(PackageNamespace(""),"Array")
         astypelate
         coerce Qname(PackageNamespace(""),"Array")
         setlocal 4
         findpropstrict Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey")
         getlocal 4
         pushbyte 0
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         getlocal 4
         pushbyte 1
         getproperty MultinameL([PrivateNamespace(null,"1282"),PackageNamespace(""),PackageNamespace("com.hurlant.util.der"),PrivateNamespace(null,"1989"),PackageInternalNs("com.hurlant.util.der"),Namespace("http://adobe.com/AS3/2006/builtin"),ProtectedNamespace("com.hurlant.util.der:PEM"),StaticProtectedNs("com.hurlant.util.der:PEM")])
         constructprop Qname(PackageNamespace("com.hurlant.crypto.rsa"),"RSAKey") 2
         returnvalue
         ofs00d3:pushnull
         returnvalue
         jump ofs00d9
         ofs00d9:pushnull
         returnvalue
         end ; code
         end ; body
         end ; method
      }
      
      public static function readCertIntoArray(param1:String) : ByteArray
      {
         trait method Qname(PackageNamespace(""),"readCertIntoArray")
         flag FINAL
         dispid 5
         method
         name null
         param Qname(PackageNamespace(""),"String")
         returns Qname(PackageNamespace("flash.utils"),"ByteArray")
         
         body
         maxstack 4
         localcount 3
         initscopedepth 3
         maxscopedepth 4
         
         code
         getlocal_0
         pushscope
         findpropstrict Qname(PrivateNamespace(null,"1282"),"extractBinary")
         getlex Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_HEADER")
         getlex Qname(PrivateNamespace(null,"1282"),"CERTIFICATE_FOOTER")
         getlocal_1
         callproperty Qname(PrivateNamespace(null,"1282"),"extractBinary") 3
         coerce Qname(PackageNamespace("flash.utils"),"ByteArray")
         setlocal_2
         getlocal_2
         returnvalue
         end ; code
         end ; body
         end ; method
      }
      
      private static function extractBinary(param1:String, param2:String, param3:String) : ByteArray
      {
         trait method Qname(PrivateNamespace(null,"1282"),"extractBinary")
         flag FINAL
         dispid 6
         method
         name null
         param Qname(PackageNamespace(""),"String")
         param Qname(PackageNamespace(""),"String")
         param Qname(PackageNamespace(""),"String")
         returns Qname(PackageNamespace("flash.utils"),"ByteArray")
         
         body
         maxstack 4
         localcount 7
         initscopedepth 3
         maxscopedepth 4
         
         code
         getlocal_0
         pushscope
         getlocal_3
         getlocal_1
         callproperty Qname(Namespace("http://adobe.com/AS3/2006/builtin"),"indexOf") 1
         convert_i
         dup
         setlocal 4
         pushbyte -1
         ifne ofs0015
         pushnull
         returnvalue
         ofs0015:getlocal 4
         getlocal_1
         getproperty Qname(PackageNamespace(""),"length")
         add
         convert_i
         setlocal 4
         getlocal_3
         getlocal_2
         callproperty Qname(Namespace("http://adobe.com/AS3/2006/builtin"),"indexOf") 1
         convert_i
         dup
         setlocal 5
         pushbyte -1
         ifne ofs0032
         pushnull
         returnvalue
         ofs0032:getlocal_3
         getlocal 4
         getlocal 5
         callproperty Qname(Namespace("http://adobe.com/AS3/2006/builtin"),"substring") 2
         coerce_s
         dup
         setlocal 6
         getlex Qname(PackageNamespace(""),"RegExp")
         pushstring "\\s"
         pushstring "mg"
         construct 2
         pushstring ""
         callproperty Qname(Namespace("http://adobe.com/AS3/2006/builtin"),"replace") 2
         coerce_s
         setlocal 6
         getlex Qname(PackageNamespace("com.hurlant.util"),"Base64")
         getlocal 6
         callproperty Qname(PackageNamespace(""),"decodeToByteArray") 1
         returnvalue
         end ; code
         end ; body
         end ; method
      }
   }
}
